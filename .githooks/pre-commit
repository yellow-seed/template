#!/bin/bash
set -euo pipefail

LOG_PREFIX="[pre-commit]"

log() {
  echo "$LOG_PREFIX $*" >&2
}

if ! REPO_ROOT=$(git rev-parse --show-toplevel 2>/dev/null); then
  log "Not inside a git repository."
  exit 0
fi

cd "$REPO_ROOT"

changed_files=()
while IFS= read -r file; do
  changed_files+=("$file")
done < <(git diff --cached --name-only --diff-filter=ACMR)

if [ "${#changed_files[@]}" -eq 0 ]; then
  log "No staged files to check."
  exit 0
fi

log "Running checks for staged files..."
"$REPO_ROOT/.githooks/run-checks.sh" "${changed_files[@]}"
