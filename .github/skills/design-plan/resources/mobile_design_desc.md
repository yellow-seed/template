# モバイルアプリ開発: 画面・操作仕様設計

モバイルアプリ開発における設計ドキュメントの作成ガイドです。

## 作成する設計ドキュメント

`docs/design/mobile-specification.md` を作成:

- **画面遷移図**: 画面間の遷移とナビゲーション
- **各画面の操作フロー**: ユーザーの操作手順
- **UI要素とレイアウト**: ボタン、入力欄、リスト等
- **プラットフォーム固有の考慮事項**: iOS/Androidの差異
- **ジェスチャー**: スワイプ、ピンチ等のタッチジェスチャー
- **パフォーマンス**: 画面読み込み、アニメーション

## 補助ツール

- **Figma / Adobe XD**: モバイルUIデザインとプロトタイプ
- **Proto.io / InVision**: インタラクティブプロトタイプ
- **Zeplin**: デザイン仕様の共有
- **React Native Storybook**: React Native用コンポーネントカタログ
- **Flutter DevTools / Widgetbook**: Flutter用UI開発ツール
- **Marvel / Framer**: プロトタイピングツール

## モバイルUI仕様書テンプレート

`docs/design/mobile-specification.md`:

```markdown
# モバイルUI仕様: [アプリ名]

## 概要

[アプリの目的と主要機能]

## 対象プラットフォーム

- [ ] iOS (最低対応バージョン: iOS 14.0+)
- [ ] Android (最低対応バージョン: Android 8.0+)

## デザインモックアップ

- Figmaリンク: [URL]
- プロトタイプ: [URL]

## 画面遷移図

\`\`\`
スプラッシュ画面
↓
オンボーディング画面 (初回のみ)
↓
ログイン画面
├→ パスワードリセット画面
└→ 新規登録画面
↓
ホーム画面
├→ プロフィール画面
│ ├→ プロフィール編集画面
│ └→ 設定画面
├→ 検索画面
│ └→ 検索結果画面
│ └→ 詳細画面
└→ 通知画面
\`\`\`

## 画面一覧

| 画面名           | 説明                       | ナビゲーション    | 認証 |
| ---------------- | -------------------------- | ----------------- | ---- |
| スプラッシュ     | アプリ起動時の読み込み画面 | 自動遷移          | 不要 |
| オンボーディング | 初回起動時のチュートリアル | スワイプ/スキップ | 不要 |
| ログイン         | ユーザー認証               | ボタン            | 不要 |
| ホーム           | メインコンテンツ表示       | タブバー          | 必須 |
| プロフィール     | ユーザー情報表示           | タブバー          | 必須 |
| 設定             | アプリ設定                 | ナビゲーション    | 必須 |

## 画面詳細

### ホーム画面

#### レイアウト

\`\`\`
┌─────────────────────────┐
│ [通知アイコン] [タイトル] │ ← ヘッダー
├─────────────────────────┤
│ │
│ [検索バー] │
│ │
│ ┌───────────────┐ │
│ │ カード1 │ │ ← スクロール可能
│ │ - 画像 │ │ コンテンツ
│ │ - タイトル │ │
│ │ - 説明 │ │
│ └───────────────┘ │
│ │
│ ┌───────────────┐ │
│ │ カード2 │ │
│ └───────────────┘ │
│ │
├─────────────────────────┤
│ [ホーム] [検索] [設定] │ ← タブバー
└─────────────────────────┘
\`\`\`

#### UI要素

| 要素     | 種類          | 説明                         | アクション     |
| -------- | ------------- | ---------------------------- | -------------- |
| ヘッダー | NavigationBar | アプリタイトルと通知アイコン | 通知画面へ遷移 |
| 検索バー | SearchBar     | キーワード検索               | 検索画面へ遷移 |
| カード   | Card          | コンテンツプレビュー         | 詳細画面へ遷移 |
| タブバー | TabBar        | メイン画面切り替え           | 画面遷移       |

#### 操作フロー

1. **検索**

   - 検索バーをタップ → 検索画面へ遷移
   - キーワードを入力 → 自動補完表示
   - 検索実行 → 検索結果画面へ遷移

2. **カードタップ**

   - カードをタップ → 詳細画面へ遷移
   - 詳細画面でスワイプダウン → ホーム画面へ戻る

3. **リフレッシュ**
   - 画面を下にスワイプ → リフレッシュ開始
   - データ取得完了 → リストを更新

#### ジェスチャー

| ジェスチャー   | アクション               |
| -------------- | ------------------------ |
| タップ         | アイテム選択、画面遷移   |
| スワイプダウン | リフレッシュ             |
| スワイプレフト | アイテム削除             |
| ロングプレス   | コンテキストメニュー表示 |

#### 状態

- **ローディング**: スケルトンスクリーンまたはスピナー表示
- **エラー**: エラーメッセージと再試行ボタン
- **空**: "データがありません" メッセージ

### ログイン画面

#### レイアウト

\`\`\`
┌─────────────────────────┐
│ │
│ [ロゴ] │
│ │
│ ログイン │
│ │
│ [メールアドレス] │
│ [パスワード] │
│ │
│ [ログインボタン] │
│ │
│ パスワードを忘れた？ │
│ │
│ または │
│ │
│ [Googleでログイン] │
│ [Appleでログイン] │
│ │
│ アカウントをお持ちで │
│ ない方は？ [新規登録]│
└─────────────────────────┘
\`\`\`

#### バリデーション

| フィールド     | ルール           | エラーメッセージ                          |
| -------------- | ---------------- | ----------------------------------------- |
| メールアドレス | 必須、メール形式 | "有効なメールアドレスを入力してください"  |
| パスワード     | 必須、8文字以上  | "パスワードは8文字以上で入力してください" |

#### 操作フロー

1. **通常ログイン**

   - メールアドレスとパスワードを入力
   - ログインボタンをタップ
   - 認証成功 → ホーム画面へ遷移
   - 認証失敗 → エラーメッセージ表示

2. **ソーシャルログイン**
   - Google/Appleボタンをタップ
   - 外部認証画面へ遷移
   - 認証完了 → ホーム画面へ遷移

## プラットフォーム固有の考慮事項

### iOS

#### デザインガイドライン（Human Interface Guidelines）

- **ナビゲーション**: NavigationBar を使用
- **タブバー**: 5個以内のタブ
- **アクションシート**: 下から表示されるモーダル
- **セーフエリア**: iPhone X以降のノッチ対応

#### iOS固有の機能

- **Face ID / Touch ID**: 生体認証
- **3D Touch / Haptic Touch**: 強押し操作
- **Dynamic Type**: フォントサイズの動的変更
- **Dark Mode**: ダークモード対応

\`\`\`swift
// SafeAreaを考慮したレイアウト
struct ContentView: View {
var body: some View {
VStack {
// コンテンツ
}
.edgesIgnoringSafeArea(.bottom) // 必要に応じて
}
}
\`\`\`

### Android

#### デザインガイドライン（Material Design）

- **AppBar**: トップバーのデザイン
- **Bottom Navigation**: 3-5個のアイテム
- **Floating Action Button (FAB)**: 主要アクション
- **Navigation Drawer**: サイドメニュー

#### Android固有の機能

- **戻るボタン**: システム戻るボタンの処理
- **通知**: リッチ通知のサポート
- **ウィジェット**: ホーム画面ウィジェット
- **インテント**: アプリ間連携

\`\`\`kotlin
// 戻るボタンの処理
override fun onBackPressed() {
if (shouldInterceptBack()) {
// カスタム処理
} else {
super.onBackPressed()
}
}
\`\`\`

### プラットフォーム差異の対応

| 機能           | iOS            | Android        | 対応方針                                           |
| -------------- | -------------- | -------------- | -------------------------------------------------- |
| ナビゲーション | NavigationBar  | AppBar         | 各プラットフォームのネイティブコンポーネントを使用 |
| 戻る操作       | スワイプバック | 戻るボタン     | プラットフォームに応じた実装                       |
| モーダル表示   | 下から上       | フェードイン   | プラットフォームデフォルトに従う                   |
| 日付選択       | ホイール形式   | カレンダー形式 | 各プラットフォームのネイティブピッカー             |

## ジェスチャー詳細

### 基本ジェスチャー

| ジェスチャー | 説明                 | 用途                     |
| ------------ | -------------------- | ------------------------ |
| タップ       | 画面を軽く1回タッチ  | ボタン押下、アイテム選択 |
| ダブルタップ | 素早く2回タップ      | いいね、ズーム           |
| ロングプレス | 長押し               | コンテキストメニュー表示 |
| スワイプ     | 指をスライド         | ページ遷移、アイテム削除 |
| ピンチ       | 2本指で広げる/狭める | ズームイン/アウト        |
| パン         | 指をドラッグ         | マップの移動             |

### React Nativeでのジェスチャー実装

\`\`\`tsx
import { GestureDetector, Gesture } from 'react-native-gesture-handler';

const swipeGesture = Gesture.Fling()
.direction(Directions.LEFT)
.onEnd(() => {
// スワイプ左の処理
});

<GestureDetector gesture={swipeGesture}>
  <View>{/* コンテンツ */}</View>
</GestureDetector>
\`\`\`

### Flutterでのジェスチャー実装

\`\`\`dart
GestureDetector(
onTap: () {
// タップ処理
},
onLongPress: () {
// ロングプレス処理
},
onHorizontalDragEnd: (details) {
// スワイプ処理
},
child: Container(
// ウィジェット
),
)
\`\`\`

## アニメーション

### 画面遷移アニメーション

| 遷移        | iOS                | Android            | 実装                     |
| ----------- | ------------------ | ------------------ | ------------------------ |
| Push        | 右からスライドイン | 上からスライドイン | ネイティブデフォルト     |
| Modal       | 下から上           | フェードイン       | プラットフォーム依存     |
| Tab切り替え | フェード           | フェード           | カスタムアニメーション可 |

### UI要素のアニメーション

\`\`\`tsx
// React Native (Animated API)
import { Animated } from 'react-native';

const fadeAnim = useRef(new Animated.Value(0)).current;

Animated.timing(fadeAnim, {
toValue: 1,
duration: 300,
useNativeDriver: true,
}).start();

<Animated.View style={{ opacity: fadeAnim }}>
{/_ コンテンツ _/}
</Animated.View>
\`\`\`

\`\`\`dart
// Flutter
AnimatedOpacity(
opacity: \_visible ? 1.0 : 0.0,
duration: Duration(milliseconds: 300),
child: Container(
// ウィジェット
),
)
\`\`\`

## パフォーマンス要件

### 目標値

| 項目           | 目標                        |
| -------------- | --------------------------- |
| 起動時間       | 2秒以内                     |
| 画面遷移       | 300ms以内                   |
| API レスポンス | 1秒以内（通常通信）         |
| アニメーション | 60fps（可能であれば120fps） |
| メモリ使用量   | 200MB以下（アイドル時）     |

### 最適化テクニック

1. **リスト最適化**

   - FlatList（React Native）/ ListView.builder（Flutter）を使用
   - 仮想化（Virtualization）でメモリ節約

2. **画像最適化**

   - 適切なサイズにリサイズ
   - キャッシュ機能の活用
   - 遅延読み込み（Lazy Loading）

3. **バンドルサイズ削減**
   - コード分割
   - 未使用コードの削除
   - 圧縮

## オフライン対応

### ローカルストレージ

| データ           | 保存場所      | 用途             |
| ---------------- | ------------- | ---------------- |
| 認証トークン     | SecureStorage | ログイン状態維持 |
| ユーザー設定     | AsyncStorage  | アプリ設定       |
| キャッシュデータ | SQLite/Realm  | オフライン表示   |

### オフライン動作

\`\`\`
ネットワーク確認
↓
オンライン → API呼び出し → データ取得 → キャッシュに保存
↓
オフライン → キャッシュから読み込み → 古いデータ表示
\`\`\`

## プッシュ通知

### 通知の種類

- **ローカル通知**: アプリ内でスケジュール
- **リモート通知**: サーバーからプッシュ

### 通知ペイロード例

\`\`\`json
{
"notification": {
"title": "新しいメッセージ",
"body": "山田太郎さんからメッセージが届いています"
},
"data": {
"type": "message",
"messageId": "12345"
}
}
\`\`\`

## テスト設計の考慮事項

1. **ユニットテスト**

   - ビジネスロジックのテスト
   - バリデーションのテスト

2. **ウィジェット/コンポーネントテスト**

   - UI要素の表示確認
   - ユーザー操作のシミュレーション

3. **統合テスト**

   - 画面遷移のテスト
   - APIとの連携テスト

4. **実機テスト**
   - 様々なデバイスサイズで確認
   - OS バージョン互換性確認

## 設計チェックリスト

- [ ] 画面遷移が明確に定義されているか
- [ ] 各画面のレイアウトが仕様化されているか
- [ ] ジェスチャー操作が適切に設計されているか
- [ ] iOS/Android の差異が考慮されているか
- [ ] パフォーマンス要件が定義されているか
- [ ] オフライン動作が考慮されているか
- [ ] エラー状態の表示が設計されているか
- [ ] ローディング状態の表示が設計されているか
- [ ] アクセシビリティが考慮されているか
- [ ] プッシュ通知の仕様が定義されているか
```
