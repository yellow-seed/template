---
name: code-review
description: "コードレビュースキル。現在のブランチとリモートオリジンの作成元ブランチとの差分を分析。Use when: コードレビュー、PR前チェック、変更点確認を依頼された時。"
---

# コードレビュー

現在のブランチとリモートオリジンの作成元ブランチとの差分を分析し、包括的なコードレビューを実施します。

## レビュー観点

| 観点 | チェック内容 |
| ----- | ------------- |
| コード品質 | 可読性、保守性、複雑度、命名規則 |
| ベストプラクティス | コーディング規約、設計パターン、アーキテクチャ整合性 |
| 潜在的バグ | ロジックエラー、エッジケース、エラーハンドリング |
| パフォーマンス | 非効率な実装、アルゴリズム最適化、リソース使用 |
| セキュリティ | 脆弱性、入力検証、認証認可 |
| テストカバレッジ | テストの適切性、網羅性、品質 |

## レビュー手順

1. **差分取得**: 現在のブランチとリモートオリジンの作成元ブランチの差分を取得
2. **ファイル分析**: 変更されたファイルごとに詳細分析
3. **問題検出**: 各レビュー観点から問題を検出
4. **改善提案**: 具体的な修正案とコード例を提供
5. **総合評価**: マージ可否の推奨を提示

## セルフレビュー（ブランチ差分チェック）

PR作成前やコミット前に、自分の変更内容を客観的に確認するためのセルフレビュープロセスです。

### セルフレビューの目的

- バグや問題の早期発見
- コードの品質向上
- レビュアーの負担軽減
- PR作成時の説明の質向上

### セルフレビュー実施のタイミング

1. **コミット前**: 小さな変更でも差分を確認
2. **機能完成時**: 機能全体の変更を通しで確認
3. **PR作成前**: 最終チェックとして必ず実施
4. **レビュー指摘後**: 修正内容が適切か確認

### セルフレビュー手順

#### 1. ベースブランチとの差分を確認

```bash
# 派生元ブランチ（通常はmain）との差分を確認
git diff main...HEAD

# 変更ファイル一覧を確認
git diff main...HEAD --name-only

# 統計情報を確認
git diff main...HEAD --stat
```

#### 2. レビュー観点でチェック

各レビュー観点から自分のコードを確認：

| 観点 | チェック内容 |
| ----- | ------------- |
| **意図した変更のみか** | 不要な変更や予期しない変更が含まれていないか |
| **コード品質** | 可読性、保守性、命名規則は適切か |
| **デバッグコードの削除** | console.log、コメントアウトされたコードは削除したか |
| **エラーハンドリング** | 適切にエラーを処理しているか |
| **テストカバレッジ** | 変更に対応するテストが追加されているか |
| **ドキュメント** | 必要なドキュメントは更新されているか |
| **セキュリティ** | 脆弱性の原因となるコードはないか |
| **パフォーマンス** | 非効率な実装はないか |

#### 3. コミット単位でレビュー

```bash
# コミット一覧を確認
git log main...HEAD --oneline

# 各コミットの差分を確認
git show <commit-hash>
```

各コミットについて:
- コミットメッセージが適切か
- コミット粒度が適切か（1コミット1機能）
- コミット間で論理的な流れになっているか

#### 4. AI Agentによるセルフレビュー

```bash
# code-review スキルを使用
"ブランチの差分をレビューしてください"
```

AI Agentが自動的に:
- ベースブランチとの差分を分析
- 問題点や改善提案を提示
- セキュリティやパフォーマンスの観点で評価

### セルフレビューチェックリスト

- [ ] 意図した変更のみが含まれている
- [ ] デバッグコード（console.log等）を削除した
- [ ] コメントアウトされた不要なコードを削除した
- [ ] コード品質（可読性、保守性）が適切
- [ ] エラーハンドリングが適切
- [ ] テストが追加されている
- [ ] ドキュメントが更新されている
- [ ] セキュリティ上の問題がない
- [ ] パフォーマンス上の問題がない
- [ ] コミットメッセージが適切
- [ ] コミット粒度が適切

## 出力形式

### サマリー

- 変更ファイル数
- 追加/削除行数
- 影響範囲の評価

### ファイル別レビュー

各ファイルについて:

- 変更内容の説明
- 指摘事項（重要度: Critical / High / Medium / Low）
- 改善提案

### 総合評価

- 全体的な品質評価
- マージ推奨/要修正の判定
- 優先対応すべき事項
